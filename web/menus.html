<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë©”ë‰´ ê´€ë¦¬ - ìŠ¤ë§ˆíŠ¸ í‚¤ì˜¤ìŠ¤í¬ ê´€ë¦¬ì</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header class="header">
        <div class="header-container">
            <div class="logo">ğŸª ìŠ¤ë§ˆíŠ¸ í‚¤ì˜¤ìŠ¤í¬ ê´€ë¦¬ì</div>
            <nav class="nav-links">
                <a href="index.html">ëŒ€ì‹œë³´ë“œ</a>
                <a href="menus.html" class="active">ë©”ë‰´ ê´€ë¦¬</a>
                <a href="orders.html">ì£¼ë¬¸ ë‚´ì—­</a>
                <a href="statistics.html">ì£¼ë¬¸ í†µê³„</a>
                <a href="advertisements.html">ê´‘ê³  ê´€ë¦¬</a>
            </nav>
        </div>
    </header>

    <div class="container">
        <div class="card-header">
            <h1 class="card-title">ë©”ë‰´ ê´€ë¦¬</h1>
            <button class="btn btn-success" onclick="showAddMenuModal()">
                â• ìƒˆ ë©”ë‰´ ì¶”ê°€
            </button>
        </div>

        <!-- í•„í„° ë° ê²€ìƒ‰ -->
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">í•„í„° ë° ê²€ìƒ‰</h2>
                <button class="btn btn-sm btn-secondary" onclick="resetFilters()">
                    ğŸ”„ í•„í„° ì´ˆê¸°í™”
                </button>
            </div>
            <div class="grid grid-4">
                <div class="form-group">
                    <label class="form-label">ì¹´í…Œê³ ë¦¬</label>
                    <select class="form-select" id="categoryFilter" onchange="applyFilters()">
                        <option value="">ì „ì²´ ì¹´í…Œê³ ë¦¬</option>
                        <option value="ì»¤í”¼">ì»¤í”¼</option>
                        <option value="í‹°">í‹°</option>
                        <option value="ìŠ¤ë¬´ë””">ìŠ¤ë¬´ë””</option>
                        <option value="ë¼ë–¼">ë¼ë–¼</option>
                        <option value="ì—ì´ë“œ">ì—ì´ë“œ</option>
                        <option value="ë””ì €íŠ¸">ë””ì €íŠ¸</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">íŒë§¤ ìƒíƒœ</label>
                    <select class="form-select" id="availabilityFilter" onchange="applyFilters()">
                        <option value="">ì „ì²´ ìƒíƒœ</option>
                        <option value="true">íŒë§¤ ì¤‘</option>
                        <option value="false">í’ˆì ˆ</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">ë©”ë‰´ëª… ê²€ìƒ‰</label>
                    <input type="text" class="form-control" id="searchInput" placeholder="ë©”ë‰´ëª…ì„ ì…ë ¥í•˜ì„¸ìš”" onkeyup="applyFilters()">
                </div>
                <div class="form-group">
                    <label class="form-label">ê°€ê²© ë²”ìœ„</label>
                    <select class="form-select" id="priceRangeFilter" onchange="applyFilters()">
                        <option value="">ì „ì²´ ê°€ê²©</option>
                        <option value="0-3000">0 - 3,000ì›</option>
                        <option value="3000-5000">3,000 - 5,000ì›</option>
                        <option value="5000-10000">5,000 - 10,000ì›</option>
                        <option value="10000-999999">10,000ì› ì´ìƒ</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- ë©”ë‰´ í†µê³„ -->
        <div class="grid grid-4">
            <div class="stat-card">
                <div class="stat-number" id="totalMenusCount">-</div>
                <div class="stat-label">ì „ì²´ ë©”ë‰´</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="availableMenusCount">-</div>
                <div class="stat-label">íŒë§¤ ì¤‘</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="soldOutMenusCount">-</div>
                <div class="stat-label">í’ˆì ˆ</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="averagePrice">-</div>
                <div class="stat-label">í‰ê·  ê°€ê²©</div>
            </div>
        </div>

        <!-- ë©”ë‰´ ëª©ë¡ -->
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">ë©”ë‰´ ëª©ë¡</h2>
                <div class="d-flex gap-2">
                    <select class="form-select" id="sortBy" onchange="applyFilters()" style="width: 200px;">
                        <option value="name">ì´ë¦„ìˆœ</option>
                        <option value="price">ê°€ê²©ìˆœ</option>
                        <option value="category">ì¹´í…Œê³ ë¦¬ìˆœ</option>
                        <option value="updatedAt">ìµœê·¼ ìˆ˜ì •ìˆœ</option>
                    </select>
                    <button class="btn btn-sm btn-secondary" onclick="toggleSortOrder()">
                        <span id="sortOrderText">â¬†ï¸</span>
                    </button>
                </div>
            </div>
            <div id="menusList" class="table-responsive">
                <div class="loading">
                    <div class="spinner"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- ë©”ë‰´ ì¶”ê°€/ìˆ˜ì • ëª¨ë‹¬ -->
    <div id="menuModal" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <span class="modal-close" onclick="closeMenuModal()">&times;</span>
            <h2 id="modalTitle">ìƒˆ ë©”ë‰´ ì¶”ê°€</h2>
            
            <form id="menuForm" onsubmit="submitMenu(event)">
                <div class="grid grid-2">
                    <div class="form-group">
                        <label class="form-label">ë©”ë‰´ ID *</label>
                        <input type="text" class="form-control" id="menuId" required>
                        <small>ì˜ë¬¸, ìˆ«ì, í•˜ì´í”ˆë§Œ ì‚¬ìš© ê°€ëŠ¥</small>
                    </div>
                    <div class="form-group">
                        <label class="form-label">ë©”ë‰´ëª… *</label>
                        <input type="text" class="form-control" id="menuName" required>
                    </div>
                </div>

                <div class="grid grid-2">
                    <div class="form-group">
                        <label class="form-label">ì¹´í…Œê³ ë¦¬ *</label>
                        <select class="form-select" id="menuCategory" required>
                            <option value="">ì¹´í…Œê³ ë¦¬ ì„ íƒ</option>
                            <option value="ì»¤í”¼">ì»¤í”¼</option>
                            <option value="í‹°">í‹°</option>
                            <option value="ìŠ¤ë¬´ë””">ìŠ¤ë¬´ë””</option>
                            <option value="ë¼ë–¼">ë¼ë–¼</option>
                            <option value="ì—ì´ë“œ">ì—ì´ë“œ</option>
                            <option value="ë””ì €íŠ¸">ë””ì €íŠ¸</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">ê°€ê²© *</label>
                        <input type="number" class="form-control" id="menuPrice" required min="0">
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">ì„¤ëª…</label>
                    <textarea class="form-control" id="menuDescription" rows="3" placeholder="ë©”ë‰´ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
                </div>

                <div class="form-group">
                    <label class="form-label">ì´ë¯¸ì§€ URL</label>
                    <input type="url" class="form-control" id="menuImage" placeholder="ì´ë¯¸ì§€ URLì„ ì…ë ¥í•˜ì„¸ìš”">
                    <small>ì˜ˆ: /img/coffee/ì•„ë©”ë¦¬ì¹´ë…¸.jpg</small>
                </div>

                <div class="form-group">
                    <label class="form-label">ì˜µì…˜ ì„¤ì •</label>
                    <div class="grid grid-3">
                        <div>
                            <label class="form-label">ì‚¬ì´ì¦ˆ</label>
                            <div class="checkbox-group">
                                <label><input type="checkbox" value="small"> ìŠ¤ëª°</label>
                                <label><input type="checkbox" value="medium"> ë¯¸ë””ì—„</label>
                                <label><input type="checkbox" value="large"> ë¼ì§€</label>
                            </div>
                        </div>
                        <div>
                            <label class="form-label">ì˜¨ë„</label>
                            <div class="checkbox-group">
                                <label><input type="checkbox" value="hot"> HOT</label>
                                <label><input type="checkbox" value="ice"> ICE</label>
                            </div>
                        </div>
                        <div>
                            <label class="form-label">ì¶”ê°€ ì˜µì…˜</label>
                            <div class="checkbox-group">
                                <label><input type="checkbox" value="extra-shot"> ìƒ· ì¶”ê°€</label>
                                <label><input type="checkbox" value="decaf"> ë””ì¹´í˜ì¸</label>
                                <label><input type="checkbox" value="soy-milk"> ë‘ìœ </label>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">íŒë§¤ ìƒíƒœ</label>
                    <select class="form-select" id="menuAvailability">
                        <option value="true">íŒë§¤ ì¤‘</option>
                        <option value="false">í’ˆì ˆ</option>
                    </select>
                </div>

                <div class="d-flex justify-content-between mt-3">
                    <button type="button" class="btn btn-secondary" onclick="closeMenuModal()">
                        ì·¨ì†Œ
                    </button>
                    <button type="submit" class="btn btn-success">
                        ì €ì¥
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script src="script.js"></script>
    <script>
        let allMenus = [];
        let filteredMenus = [];
        let sortOrder = 'asc';
        let currentEditingMenu = null;

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ë©”ë‰´ ëª©ë¡ ë¡œë“œ
        document.addEventListener('DOMContentLoaded', loadMenus);

        // ë©”ë‰´ ëª©ë¡ ë¡œë“œ
        async function loadMenus() {
            try {
                Loading.show('#menusList');
                const response = await API.get('/menus');
                allMenus = response.data;
                filteredMenus = [...allMenus];
                
                renderMenus();
                updateStatistics();
                
            } catch (error) {
                console.error('ë©”ë‰´ ë¡œë“œ ì‹¤íŒ¨:', error);
                Notification.error('ë©”ë‰´ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            } finally {
                Loading.hide('#menusList');
            }
        }

        // ë©”ë‰´ ë Œë”ë§
        function renderMenus() {
            const container = document.getElementById('menusList');
            
            if (filteredMenus.length === 0) {
                container.innerHTML = '<p class="text-center">ì¡°ê±´ì— ë§ëŠ” ë©”ë‰´ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }

            const columns = [
                { 
                    key: 'image', 
                    header: 'ì´ë¯¸ì§€',
                    render: (value) => value ? 
                        `<img src="${value}" alt="ë©”ë‰´" style="width: 60px; height: 60px; object-fit: cover; border-radius: 5px;">` : 
                        '<div style="width: 60px; height: 60px; background: #f0f0f0; border-radius: 5px; display: flex; align-items: center; justify-content: center; font-size: 12px;">ì´ë¯¸ì§€<br>ì—†ìŒ</div>'
                },
                { key: 'name', header: 'ë©”ë‰´ëª…' },
                { 
                    key: 'category', 
                    header: 'ì¹´í…Œê³ ë¦¬',
                    render: (value) => Utils.getCategoryName(value)
                },
                { 
                    key: 'price', 
                    header: 'ê°€ê²©',
                    render: (value) => Utils.formatPrice(value)
                },
                { 
                    key: 'isAvailable', 
                    header: 'íŒë§¤ ìƒíƒœ',
                    render: (value) => value ? 
                        '<span class="badge badge-success">íŒë§¤ ì¤‘</span>' : 
                        '<span class="badge badge-danger">í’ˆì ˆ</span>'
                },
                { 
                    key: 'options', 
                    header: 'ì˜µì…˜',
                    render: (value) => {
                        const optionCount = (value.size?.length || 0) + (value.temperature?.length || 0) + (value.extras?.length || 0);
                        return optionCount > 0 ? `${optionCount}ê°œ` : 'ì—†ìŒ';
                    }
                },
                { 
                    key: 'updatedAt', 
                    header: 'ìµœê·¼ ìˆ˜ì •',
                    render: (value) => Utils.formatDate(value)
                }
            ];

            const actions = [
                {
                    text: 'ìˆ˜ì •',
                    class: 'btn-primary',
                    onClick: (menu) => editMenu(menu)
                },
                {
                    text: menu => menu.isAvailable ? 'í’ˆì ˆ' : 'íŒë§¤',
                    class: menu => menu.isAvailable ? 'btn-warning' : 'btn-success',
                    onClick: (menu) => toggleMenuAvailability(menu)
                },
                {
                    text: 'ì‚­ì œ',
                    class: 'btn-danger',
                    onClick: (menu) => deleteMenu(menu)
                }
            ];

            Table.render(container, filteredMenus, columns, actions);
        }

        // í†µê³„ ì—…ë°ì´íŠ¸
        function updateStatistics() {
            const total = allMenus.length;
            const available = allMenus.filter(menu => menu.isAvailable).length;
            const soldOut = total - available;
            const averagePrice = total > 0 ? Math.round(allMenus.reduce((sum, menu) => sum + menu.price, 0) / total) : 0;

            document.getElementById('totalMenusCount').textContent = total;
            document.getElementById('availableMenusCount').textContent = available;
            document.getElementById('soldOutMenusCount').textContent = soldOut;
            document.getElementById('averagePrice').textContent = Utils.formatPrice(averagePrice);
        }

        // í•„í„° ì ìš©
        function applyFilters() {
            const categoryFilter = document.getElementById('categoryFilter').value;
            const availabilityFilter = document.getElementById('availabilityFilter').value;
            const searchInput = document.getElementById('searchInput').value.toLowerCase();
            const priceRangeFilter = document.getElementById('priceRangeFilter').value;
            const sortBy = document.getElementById('sortBy').value;

            filteredMenus = allMenus.filter(menu => {
                // ì¹´í…Œê³ ë¦¬ í•„í„°
                if (categoryFilter && menu.category !== categoryFilter) return false;
                
                // íŒë§¤ ìƒíƒœ í•„í„°
                if (availabilityFilter && menu.isAvailable.toString() !== availabilityFilter) return false;
                
                // ê²€ìƒ‰ í•„í„°
                if (searchInput && !menu.name.toLowerCase().includes(searchInput)) return false;
                
                // ê°€ê²© ë²”ìœ„ í•„í„°
                if (priceRangeFilter) {
                    const [min, max] = priceRangeFilter.split('-').map(Number);
                    if (menu.price < min || menu.price > max) return false;
                }
                
                return true;
            });

            // ì •ë ¬ ì ìš©
            applySorting(sortBy);
            
            renderMenus();
        }

        // ì •ë ¬ ì ìš©
        function applySorting(sortBy) {
            filteredMenus.sort((a, b) => {
                let aValue = a[sortBy];
                let bValue = b[sortBy];
                
                if (sortBy === 'updatedAt') {
                    aValue = new Date(aValue);
                    bValue = new Date(bValue);
                }
                
                if (sortOrder === 'asc') {
                    return aValue > bValue ? 1 : -1;
                } else {
                    return aValue < bValue ? 1 : -1;
                }
            });
        }

        // ì •ë ¬ ìˆœì„œ í† ê¸€
        function toggleSortOrder() {
            sortOrder = sortOrder === 'asc' ? 'desc' : 'asc';
            document.getElementById('sortOrderText').textContent = sortOrder === 'asc' ? 'â¬†ï¸' : 'â¬‡ï¸';
            applyFilters();
        }

        // í•„í„° ì´ˆê¸°í™”
        function resetFilters() {
            document.getElementById('categoryFilter').value = '';
            document.getElementById('availabilityFilter').value = '';
            document.getElementById('searchInput').value = '';
            document.getElementById('priceRangeFilter').value = '';
            document.getElementById('sortBy').value = 'name';
            sortOrder = 'asc';
            document.getElementById('sortOrderText').textContent = 'â¬†ï¸';
            applyFilters();
        }

        // ë©”ë‰´ ì¶”ê°€ ëª¨ë‹¬ í‘œì‹œ
        function showAddMenuModal() {
            currentEditingMenu = null;
            document.getElementById('modalTitle').textContent = 'ìƒˆ ë©”ë‰´ ì¶”ê°€';
            document.getElementById('menuForm').reset();
            document.getElementById('menuId').disabled = false;
            document.getElementById('menuModal').style.display = 'block';
        }

        // ë©”ë‰´ ìˆ˜ì •
        function editMenu(menu) {
            currentEditingMenu = menu;
            document.getElementById('modalTitle').textContent = 'ë©”ë‰´ ìˆ˜ì •';
            
            // í¼ í•„ë“œ ì±„ìš°ê¸°
            document.getElementById('menuId').value = menu.id;
            document.getElementById('menuId').disabled = true;
            document.getElementById('menuName').value = menu.name;
            document.getElementById('menuCategory').value = menu.category;
            document.getElementById('menuPrice').value = menu.price;
            document.getElementById('menuDescription').value = menu.description || '';
            document.getElementById('menuImage').value = menu.image || '';
            document.getElementById('menuAvailability').value = menu.isAvailable.toString();
            
            // ì˜µì…˜ ì²´í¬ë°•ìŠ¤ ì„¤ì •
            const sizeCheckboxes = document.querySelectorAll('[value="small"], [value="medium"], [value="large"]');
            sizeCheckboxes.forEach(cb => {
                cb.checked = menu.options.size?.includes(cb.value) || false;
            });
            
            const tempCheckboxes = document.querySelectorAll('[value="hot"], [value="ice"]');
            tempCheckboxes.forEach(cb => {
                cb.checked = menu.options.temperature?.includes(cb.value) || false;
            });
            
            const extraCheckboxes = document.querySelectorAll('[value="extra-shot"], [value="decaf"], [value="soy-milk"]');
            extraCheckboxes.forEach(cb => {
                cb.checked = menu.options.extras?.includes(cb.value) || false;
            });
            
            document.getElementById('menuModal').style.display = 'block';
        }

        // ë©”ë‰´ ëª¨ë‹¬ ë‹«ê¸°
        function closeMenuModal() {
            document.getElementById('menuModal').style.display = 'none';
            currentEditingMenu = null;
        }

        // ë©”ë‰´ ì €ì¥
        async function submitMenu(event) {
            event.preventDefault();
            
            try {
                Loading.show();
                
                const formData = {
                    id: document.getElementById('menuId').value,
                    name: document.getElementById('menuName').value,
                    category: document.getElementById('menuCategory').value,
                    price: parseInt(document.getElementById('menuPrice').value),
                    description: document.getElementById('menuDescription').value,
                    image: document.getElementById('menuImage').value,
                    isAvailable: document.getElementById('menuAvailability').value === 'true',
                    options: {
                        size: Array.from(document.querySelectorAll('#sizeOptions input[type="checkbox"]'))
                            .filter(cb => cb.checked)
                            .map(cb => cb.value),
                        temperature: Array.from(document.querySelectorAll('#temperatureOptions input[type="checkbox"]'))
                            .filter(cb => cb.checked)
                            .map(cb => cb.value),
                        extras: Array.from(document.querySelectorAll('#extraOptions input[type="checkbox"]'))
                            .filter(cb => cb.checked)
                            .map(cb => cb.value)
                    }
                };
                
                if (currentEditingMenu) {
                    // ìˆ˜ì •
                    await API.put(`/menus/${currentEditingMenu.id}`, formData);
                    Notification.success('ë©”ë‰´ê°€ ì„±ê³µì ìœ¼ë¡œ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.');
                } else {
                    // ì¶”ê°€
                    await API.post('/menus', formData);
                    Notification.success('ë©”ë‰´ê°€ ì„±ê³µì ìœ¼ë¡œ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.');
                }
                
                closeMenuModal();
                await loadMenus();
                
            } catch (error) {
                console.error('ë©”ë‰´ ì €ì¥ ì‹¤íŒ¨:', error);
                Notification.error('ë©”ë‰´ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + error.message);
            } finally {
                Loading.hide();
            }
        }

        // ë©”ë‰´ íŒë§¤ ìƒíƒœ í† ê¸€
        async function toggleMenuAvailability(menu) {
            const newStatus = !menu.isAvailable;
            const action = newStatus ? 'íŒë§¤ ì¬ê°œ' : 'í’ˆì ˆ ì²˜ë¦¬';
            
            Modal.confirm(
                'íŒë§¤ ìƒíƒœ ë³€ê²½',
                `'${menu.name}' ë©”ë‰´ë¥¼ ${action}í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`,
                async () => {
                    try {
                        Loading.show();
                        await API.put(`/menus/${menu.id}`, { isAvailable: newStatus });
                        Notification.success(`ë©”ë‰´ê°€ ${action}ë˜ì—ˆìŠµë‹ˆë‹¤.`);
                        await loadMenus();
                    } catch (error) {
                        console.error('ë©”ë‰´ ìƒíƒœ ë³€ê²½ ì‹¤íŒ¨:', error);
                        Notification.error('ë©”ë‰´ ìƒíƒœ ë³€ê²½ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                    } finally {
                        Loading.hide();
                    }
                }
            );
        }

        // ë©”ë‰´ ì‚­ì œ
        async function deleteMenu(menu) {
            Modal.confirm(
                'ë©”ë‰´ ì‚­ì œ',
                `'${menu.name}' ë©”ë‰´ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?<br><strong>ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</strong>`,
                async () => {
                    try {
                        Loading.show();
                        await API.delete(`/menus/${menu.id}`);
                        Notification.success('ë©”ë‰´ê°€ ì„±ê³µì ìœ¼ë¡œ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                        await loadMenus();
                    } catch (error) {
                        console.error('ë©”ë‰´ ì‚­ì œ ì‹¤íŒ¨:', error);
                        Notification.error('ë©”ë‰´ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                    } finally {
                        Loading.hide();
                    }
                }
            );
        }

        // ì²´í¬ë°•ìŠ¤ ê·¸ë£¹ ìŠ¤íƒ€ì¼
        const checkboxStyle = `
            .checkbox-group {
                display: flex;
                flex-direction: column;
                gap: 0.5rem;
            }
            .checkbox-group label {
                display: flex;
                align-items: center;
                gap: 0.5rem;
                font-weight: normal;
                cursor: pointer;
            }
            .checkbox-group input[type="checkbox"] {
                width: auto;
                margin: 0;
            }
        `;

        const style = document.createElement('style');
        style.textContent = checkboxStyle;
        document.head.appendChild(style);
    </script>
</body>
</html> 